<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./include/ol.css" type="text/css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" type="text/css">
  <script src="./include/ol.js"></script>
  <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <style>
    #marker {
      /* 画圆形 */
      width: 20px;
      height: 20px;
      border: 1px solid #088;
      border-radius: 10px;
      background-color: #0ff;
      opacity: 0.5;
    }

    #vienna {
      text-decoration: none;
      color: white;
      font-size: 11pt;
      font-weight: bold;
      text-shadow: black 0.1em 0.1em 0.2em;
    }

    .popover-content {
      min-width: 180px;
    }
  </style>
</head>

<body>
  <div id="map" class="map"></div>
  <div style="display: none;">
    <!-- 维也纳地名标签 -->
    <a class="overlay" id="vienna" target="_blank"
      href="https://baike.baidu.com/item/%E7%BB%B4%E4%B9%9F%E7%BA%B3/6412?fr=aladdin">维也纳</a>
    <!-- marker圆形容器 -->
    <div id="marker" title="Marker"></div>
    <!-- 弹出窗口容器 -->
    <div id="popup" title="欢迎使用 Openlayers"></div>
  </div>
  <script>
    var layer = new ol.layer.Tile({ //对layer对象的缓存
      source: new ol.source.OSM()
    });
    var map = new ol.Map({
      layers: [layer],
      target: 'map',
      view: new ol.View({
        center: [0, 0],
        zoom: 2
      })
    });
    var pos = ol.proj.fromLonLat([16.3725, 48.208889]);
    //默认为Web Mercator，即'EPSG：3857'。
    //对经纬度坐标的转换。ol默认投影坐标系3857，经纬度坐标转换为xy坐标，

    // 1.声明代表维也纳的标记（圆形呈现）
    var marker = new ol.Overlay({
      position: pos, //位置定位（overlay相对pos的定位 ）
      positioning: 'center-center', // 在pos中心定位
      element: document.getElementById('marker'), //element是overlay绑定的dom对象
      stopEvent: false
      //stopEvent 冒泡与捕获及阻止默认动作
    });
    map.addOverlay(marker);

    //2.代表维也纳的文字注释
    var vienna = new ol.Overlay({
      position: pos, //    //默认左上角与position重合的,相对于文字左上角与文字对齐
      element: document.getElementById('vienna')
    })
    map.addOverlay(vienna); //addOverlay （叠加层）将给定的叠加层添加到地图map对象

    //3.显示用户点击位置经纬度的弹窗
    var popup = new ol.Overlay({
      element: document.getElementById('popup') //跟popup的DOM对象进行绑定
    });
    map.addOverlay(popup);

    map.on('click', function (evt) { //响应函数：绑定左键单击处理popup弹出过程
      var element = popup.getElement(); //声明变量。将popup的dom对象先缓存起来
      //getElement （）{HTMLElement |未定义}
      //https://openlayers.org/en/v5.3.0/apidoc/module-ol_Overlay-Overlay.html#getElement
      // Overlay.js，第223行
      // 获取此叠加层的DOM元素。
      // 返回值：
      // 包含叠加层的元素。
      var coordinate = evt.coordinate; //获取单机的xy坐标
      console.log(evt);
      var hdms = ol.coordinate.toStringHDMS(ol.proj.toLonLat(coordinate)); //将xy坐标转换为经纬度坐标

      //bootstrap实现的弹窗坐标
      // https://getbootstrap.com/docs/3.4/javascript/#popovers
      $(element).popover('destroy'); //如果原来存在弹框先销毁
      popup.setPosition(coordinate); //将popup位置定位到coordinate（用户点击的）原来的位置
      $(element).popover({
        placement: 'top', //如何放置弹出框
        animation: false,
        html: true,
        //将HTML插入弹出窗口。如果为false，text则将使用jQuery的方法将内容插入DOM。如果您担心XSS攻击，请使用文本
        content: "<p>您点击的位置，坐标是</p><code>" + hdms + "</code>"
      });
      $(element).popover("show");
    })
  </script>
</body>

</html>

<!-- 
  总结：
   三种常见Overlay的用法：
      - 弹出式窗口popup
      - 点标记marker
      - 文字标签label

-->