<!--
 * @Author: your name
 * @Date: 2020-10-05 22:45:04
 * @LastEditTime: 2020-10-06 14:37:28
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \democ:\Users\12768\Desktop\ol\14.实现一个地图热力图.html
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./include/ol.css" type="text/css">
  <script src="./include/ol.js"></script>
</head>

<body>
  <form>
    <label>半径大小</label>
    <input id="radius" type="range" min="1" max="50" step="1" value="5">
    <!-- //step 属性规定输入字段的合法数字间隔 -->
    <!-- 设置input的type="range"即可得到滑动条控件 -->
    <!-- max - 规定允许的最大值。step - 规定合法数字间隔。value - 规定默认值。 -->
    <label>模糊半径</label>
    <input id="blur" type="range" min="1" max="50" step="1" value="15">
  </form>
  <div id="map" class="map"></div>

</body>
<script>
  //缓存DOM对象
  var blur = document.getElementById('blur'),
      radius = document.getElementById('radius');
  ///热力图对象矢量图层
  var vector = new ol.layer.Heatmap({
    source: new ol.source.Vector({
      url: './data/2012_Earthquakes_Mag5.kml',
      format: new ol.format.KML({ //https://openlayers.org/en/latest/apidoc/module-ol_format_KML-KML.html
        extractStyles: false //从KML中提取样式。
      })
    }),
    //获取文本框的值
    blur: parseInt(blur.value, 10), //将字符类型转换成10进制的int类型。
    radius: parseInt(radius.value, 10)
    //https://zhidao.baidu.com/question/573724611.html
    // js是一个弱数据类型的语言，baiinput框中获取的值全部为字符du串类型，另外js里边还有zhi一种类型叫做number类型，你如果要进dao行数字之间的加减，必须将字符类型转换为number类型，
  });
  //addfeature添加要素的时候处理KML数据格式，获取我们需要的数据
  //https://openlayers.org/en/latest/apidoc/module-ol_layer_Heatmap-Heatmap.html#getSource
  //getSource获取图层源。addfeature向源添加一个功能
  vector.getSource().on('addfeature', function (event) {
    //Ctrl+P后输入>  2.输入Map Preview 预览数据视图
    //https://www.cnblogs.com/dluff/p/12347862.html
    console.log(event)
    //https://openlayers.org/en/latest/apidoc/module-ol_Feature-Feature.html
    var name = event.feature.get('name'),
        magnitude = parseFloat(name.substr(2));
    // event.feature.set('weight', magnitude - 5);
  });
  //声明栅格图层
  var raster = new ol.layer.Tile({
    source: new ol.source.Stamen({ //Map Preview 预览数据视图
      layer: 'toner' //墨粉
    })
  });
  var map = new ol.Map({
    layers: [raster, vector],
    target: 'map',
    view: new ol.View({
      center: [0, 0],
      zoom: 2
    })
  });
  blur.addEventListener('input', function (event) {
    // ..https://openlayers.org/en/latest/apidoc/module-ol_layer_Heatmap-Heatmap.html#setBlur
    vector.setBlur(parseInt(blur.value, 10)); //setBlur设置模糊大小（以像素为单位）。
  })
  radius.addEventListener('input', function (event) {
    vector.setRadius(parseInt(radius.value, 10)); //setRadius设置半径的大小（以像素为单位）。
  })
</script>

</html>
<!-- https://www.sohu.com/a/420600301_120498984?p=qq百度地图、高德地图的数据原来是这么来的  -->
<!-- 国内这一块的数据，主要有两家供应商，就是高德和四维图新 -->
<!-- https://blog.csdn.net/qq_43066675/article/details/108147801 -->
<!-- https://blog.csdn.net/u013240519/article/details/82153759  //OpenLayers源码阅读（二）：体系结构 -->