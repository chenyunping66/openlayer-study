<!--
 * @Author: your name
 * @Date: 2020-10-07 14:53:49
 * @LastEditTime: 2020-10-07 17:42:31
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \democ:\Users\12768\Desktop\ol\第5节.地图图层ol.layer.的使用\21.多图层切换.html
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="../include/ol.css" type="text/css">
  <script src="../include/ol.js"></script>
  <script src="../include/jquery-3.1.1.min.js"></script>
  <style>
    #layertree li>span {
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div id="layertree">
    <h5>点击下面的图层节点，试者调整图层的参数</h5>
    <ul>
      <li>
        <span>OSM层</span>
        <fieldset id="layer0">
          <label class="checkbox" for="visible0">
            <input id="visible0" class="visible" type="checkbox">可见
          </label>
          <label>透明度</label>
          <input class="opacity" type="range" min="0" max="1" step="0.01" />
        </fieldset>
      </li>
      <li>
        <span>图层组</span>
        <fieldset id="layer1">
          <label class="checkbox" for="visible1">
            <input id="visible1" class="visible" type="checkbox" />可见
          </label>
          <label>透明度</label>
          <input class="opacity" type="range" min="0" max="1" step="0.01" />
        </fieldset>
        <ul>
          <li>
            <span>食物危机主体图层</span>
            <fieldset id="layer10">
              <label class="checkbox" for="visible10">
                <input id="visible10" class="visible" type="checkbox" />可见
              </label>
              <label>透明度</label>
              <input class="opacity" type="range" min="0" max="1" step="0.01" />
            </fieldset>
          </li>
          <li>
            <span>世界陆地边界图</span>
            <fieldset id="layer11">
              <label class="checkbox" for="visible11">
                <input id="visible11" class="visible" type="checkbox" />可见
              </label>
              <label>透明度</label>
              <input class="opacity" type="range" min="0" max="1" step="0.01" />
            </fieldset>
          </li>
        </ul>
      </li>
    </ul>
  </div>
  <div id="map"></div>
  <script>
    var map = new ol.Map({
      layers: [
        new ol.layer.Tile({
          source: new ol.source.OSM()
        }), new ol.layer.Group({
          layers: [
            new ol.layer.Tile({
              source: new ol.source.TileJSON({
                url: 'https://api.tiles.mapbox.com/v4/mapbox.20110804-hoa-foodinsecurity-3month.json?securee&access_token=pk.eyJ1IjoiYWhvY2V2YXIiLCJhIjoiY2pzbmg0Nmk5MGF5NzQzbzRnbDNoeHJrbiJ9.7_-_gL8ur7ZtEiNwRfCy7Q',
                crossOrigin: 'anonymous'
              })
            }),
            new ol.layer.Tile({
              source: new ol.source.TileJSON({
                url: 'https://api.tiles.mapbox.com/v4/mapbox.world-borders-light.json?secure&access_token=pk.eyJ1IjoiYWhvY2V2YXIiLCJhIjoiY2pzbmg0Nmk5MGF5NzQzbzRnbDNoeHJrbiJ9.7_-_gL8ur7ZtEiNwRfCy7Q',
                crossOrigin: 'anonymous'
              })
            })
          ],
        })
      ],
      target: 'map',
      view: new ol.View({
        center: ol.proj.fromLonLat([37.40570, 8.81566]),
        zoom: 4
      })
    });

    function bindInputs(layerid, layer) {
      // var visibilityInput = $(layerid + 'input.visible');
      var visibilityInput = $(layerid + ' input.visible');
      console.log(visibilityInput)
      visibilityInput.on('change', function () {
        layer.setVisible(this.checked); //setVisible  setVisible（可见）设置图层（true或false）的可见性。图层是否可见
      });
      //prop() 方法设置或返回被选元素的属性和值。 JQ
      // 当该方法用于返回属性值时，则返回第一个匹配元素的值。
      // 当该方法用于设置属性值时，则为匹配元素集合设置一个或多个属性/值对。
      visibilityInput.prop('checked', layer.getVisible());

      var opacityInput = $(layerid + ' input.opacity');
      opacityInput.on('input change', function () { //JQ事件的写法
        layer.setOpacity(parseFloat(this.value));
      });
      opacityInput.val(String(layer.getOpacity())) //J进度条透明度
    }

    map.getLayers().forEach(function (layer, i) { //获取所有的图层进行迭代
      bindInputs('#layer' + i, layer); //所有图层进行绑定
      if (layer instanceof ol.layer.Group) {
        layer.getLayers().forEach(function (sublayer, j) {
          bindInputs('#layer' + i + j, sublayer); //处理图层组
        });
      }
    });

    //对表单折叠展开
    $('#layertree li>span').click(function () {
      $(this).siblings('fieldset').toggle(); //siblings() 方法返回被选元素的所有同级元素。
    }).siblings('fieldset').hide();
  </script>
</body>

</html>